<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <title>Firebase Demo</title>
    <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/bower/skeleton/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/bower/skeleton/css/skeleton.css">
    <link rel="stylesheet" type="text/css" href="/css/bundle.css">
</head>

<body>
    <div id="flagchat">
        <div class="section">
            <div class="header container">
                <div class="row">
                    <div class="logo eight columns">
                        Demo
                    </div>
                    <div class="four columns">
                        <button id="logout" class="u-pull-right" v-if="user" v-on:click="signOut()">Logout {{user.displayName}}</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container" v-if="!user">
            <div class="row">
                <h2>
                    Digital Flagstaff
                </h2>
                <p>
                    Welcome to this demo of a Firebase website. To chat, please login.
                </p>
                <p>
                    <button class="button-primary" v-on:click="signIn('google')">Login with Google</button>
                    <button class="button-primary" v-on:click="signIn('facebook')">Login with Facebook</button>
                    <button class="button-primary" v-on:click="signIn('twitter')">Login with Twitter</button>
                </p>
            </div>
        </div>
        <div class="container" v-if="user">
            <div class="row">
                <div class="chat-form-container twelve columns">
                    <form id="chatForm" v-on:submit.prevent="sendMessage">
                        <input type="text" v-model="newMessage" placeholder="Speak your mind" class="">
                        <button class="button-primary">Send</button>
                    </form>
                </div>
                <div class="twelve columns">
                    <ul id="messagesList">
                        <li v-for="message in messages">
                            <img class="avatar" v-bind:src="message.avatar" alt="Avatar Image" />
                            <span class="user">{{message.user}}</span> {{ message.text }}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/vue@~2.1/dist/vue.min.js"></script>
    <script src="https://unpkg.com/vuefire@~1.3/dist/vuefire.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.3/firebase.js"></script>
    <script>
        <!-- Firebase Init -->
        var config = {
            apiKey: 'AIzaSyAactRscFfyWVmkw4Siz7UtOSjMHOGv5ec',
            authDomain: 'project-3181687864005492685.firebaseapp.com',
            databaseURL: 'https://project-3181687864005492685.firebaseio.com',
            storageBucket: 'project-3181687864005492685.appspot.com',
            messagingSenderId: '735018564010'
        };
        firebase.initializeApp(config);
    </script>
    <script>
        var providersRef = {
            google: new firebase.auth.GoogleAuthProvider(),
            facebook: new firebase.auth.FacebookAuthProvider(),
            twitter: new firebase.auth.TwitterAuthProvider()
        };
        var flagchat = new Vue({
            el: '#flagchat',
            data: {
                user: false,
                newMessage: ''
            },
            firebase: {
                messages: firebase.database().ref('/chats/').limitToLast(15)
            },
            methods: {
                signIn: function(providerKey) {
                    var provider = providersRef[providerKey];
                    firebase.auth().signInWithPopup(provider).then(function(user, creds) {}).catch(function(error) {
                        alert("Unable to authenticate: " + error.message);
                    });
                },
                signOut: function() {
                    firebase.auth().signOut().catch(function(error) {
                        alert("Unable to sign out: " + error.message);
                    });
                },
                sendMessage: function() {
                    if (this.newMessage == "") {
                        return alert("Please enter a message!");
                    }
                    this.$firebaseRefs.messages.push({
                        text: this.newMessage,
                        user: this.user.displayName,
                        avatar: this.user.photoURL,
                        ts: firebase.database.ServerValue.TIMESTAMP
                    });
                    this.newMessage = "";
                }
            }
        });
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                flagchat.user = user;
            } else {
                flagchat.user = false;
            }
        });
    </script>
</body>

</html>